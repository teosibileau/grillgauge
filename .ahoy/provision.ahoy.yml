ahoyapi: v2
commands:
  freeze:
    usage: Freeze python requirements to txt
    cmd: |
      echo "Freezing python dependencies to requirements.txt..."
      poetry export --without-hashes --format requirements.txt > requirements.txt

  test:
    usage: Provision the test ARM64 container
    cmd: |
      ahoy provision freeze
      echo "Starting Ansible provisioning of test container..."
      cd ansible && ansible-playbook -i inventory/hosts.ini playbooks/site.yml --limit test_servers

  deploy:
    usage: Deploy to ARM64 production device
    cmd: |
      ahoy provision freeze
      echo "⚠️  DEPLOYING TO PRODUCTION ARM64 DEVICE ⚠️"
      read -p "Are you sure? This will modify the ARM64 device. (y/N): " confirm
      if [[ $confirm == [yY] || $confirm == [yY][eE][sS] ]]; then
        cd ansible && ansible-playbook -i inventory/hosts.ini playbooks/site.yml --limit arm64_devices
      else
        echo "Deployment cancelled."
      fi
  status:
    usage: Check provisioning status
    cmd: |
      echo "=== Container Status ==="
      ahoy docker ps
      echo ""
      echo "=== Service Status ==="
      ahoy docker exec arm64-test systemctl status grillgauge prometheus grafatui --no-pager -l || echo "Container not running"
